<!DOCTYPE html>
<html>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style type="text/css">
	
	.modal-body{
	    height: 80vh;
	    overflow-y: auto;
	}
</style>

<body ng-app="myApp" ng-controller="myCtrl">

<div class="container">
  <h2>YouTube Trending Videos</h2>
  <p>Total Video Count: {{videoCount}} </p>  
  <div class="row">
  	<div class="col-md-10">
  		<input class="form-control" id="myInput" type="text" placeholder="Search..">
  	</div>
  	<div class="col-md-1">
  		<button type="button" class="btn btn-primary btn-md" ng-click="refreshVideoList()" ng-disabled="!fetchSpinner">Refresh Video List <i class="fa fa-spinner fa-spin" ng-if="!fetchSpinner" aria-hidden="true"></i></button>
  	</div>
  </div>
  <br>
  <table class="table table-bordered table-striped">
    <thead>
      <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Published At</th>
        <th>Action</th>
      </tr>
    </thead>
    <tbody id="myTable">
      <tr ng-repeat="video in videoList">
        <td>{{video.id}}</td>
        <td>{{video.snippet.title}}</td>
        <td>{{video.snippet.publishedAt}}</td>
        <td><a href="javascript:void(0);" data-toggle="modal" data-target="#myModal" ng-click="getVideoDetails(video.id,video.snippet.channelId)">View Details</a></td>
      </tr>
    </tbody>
  </table>  
</div>



  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog modal-lg">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">{{videoDetail.snippet.title}}</h4>
        </div>
        <div class="modal-body">
          <table class="table table-striped">		    
		    <tbody>
		      <tr>
		        <th>Description</td>
		        <td>{{videoDetail.snippet.description}}</td>
		      </tr>
		      <tr>
		        <th>Video URL</td>
		        <td><a href="https://www.youtube.com/watch?v={{videoDetail.id}}" target="_blank">Click here</a></td>
		      </tr>
		      <tr>
		        <th>Video Thumbnail</td>
		        <td>
		        	<div>
		        		<a href="https://i.ytimg.com/vi/36w7_45CWKk/default.jpg" target="_blank">Default</a>
		        	</div>
		        	<div>
		        		<a href="https://i.ytimg.com/vi/36w7_45CWKk/mqdefault.jpg" target="_blank">Medium (320 x 180)</a>
		        	</div>
		        	<div>
		        		<a href="https://i.ytimg.com/vi/36w7_45CWKk/hqdefault.jpg" target="_blank">High (480 x 360)</a>
		        	</div>
		        	<div>
		        		<a href="https://i.ytimg.com/vi/36w7_45CWKk/sddefault.jpg" target="_blank">standard (640 x 480)</a>
		        	</div>
		        	<div>
		        		<a href="https://i.ytimg.com/vi/36w7_45CWKk/maxresdefault.jpg" target="_blank">maxres (1280 x 720)</a>
		        	</div>
		        </td>
		      </tr>
		      <tr>
		        <th>Channel Title</td>
		        <td>{{videoDetail.snippet.channelTitle}}</td>
		      </tr>
		      <tr>
		        <th>Total View Count</td>
		        <td>{{videoStatistics.viewCount}}</td>
		      </tr>
		      <tr>
		        <th>Total Likes Count</td>
		        <td>{{videoStatistics.likeCount}}</td>
		      </tr>
		      <tr>
		        <th>Total Dislikes Count</td>
		        <td>{{videoStatistics.dislikeCount}}</td>
		      </tr>
		      <tr>
		        <th>Total Subscribers Count</td>
		        <td>{{channelDetail.subscriberCount}}</td>
		      </tr>
		      
		    </tbody>
		  </table>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>

<script>
$(document).ready(function(){
  $("#myInput").on("keyup", function() {
    var value = $(this).val().toLowerCase();
    $("#myTable tr").filter(function() {
      $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
    });
  });
});

var app = angular.module('myApp', []);
app.controller('myCtrl', function($scope, $http) {

  $scope.videoDetail="";
  $scope.channelDetail="";
  $scope.videoStatistics="";
  $scope.fetchSpinner = true;

  $http.get("http://localhost:8081/api/v1/yt/getVideosList").then(function(response) {
      $scope.videoList = response.data.responseData;
      $scope.videoCount = response.data.responseData.length;
      console.log(response)
  });

  $scope.refreshVideoList = function() {
  	$scope.fetchSpinner = false;
  	$http.get("http://localhost:8081/api/v1/yt").then(function(response) {
      if(response){
      	  $http.get("http://localhost:8081/api/v1/yt/getVideosList").then(function(response) {
		      $scope.videoList = response.data.responseData;
		      $scope.videoCount = response.data.responseData.length;
		      $scope.fetchSpinner = true;
		  });
      }
	});

  }



  $scope.getVideoDetails = function(id, channelId) {
        console.log(id);
        $http.get(`http://localhost:8081/api/v1/yt/getVideo/${id}`).then(function(response) {
		      $scope.videoDetail = response.data.responseData;
		      console.log(response)
		      if(response.data.responseData){
		      	$http.get(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${channelId}&key=AIzaSyAqXvS3mVAZZONWwG3QS983sJI3Ocdm29g`).then(function(response) {
				      $scope.channelDetail = response.data.items[0].statistics;
				      console.log(response);
				});
				$http.get(`https://www.googleapis.com/youtube/v3/videos?key=AIzaSyAqXvS3mVAZZONWwG3QS983sJI3Ocdm29g&part=statistics&id=${id}`).then(function(response) {
				      $scope.videoStatistics = response.data.items[0].statistics;
				      console.log(response);
				});
		      }
		});
  };

});
</script>

</body>
</html>
